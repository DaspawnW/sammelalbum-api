<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="md:flex md:items-center md:justify-between mb-6">
        <div class="flex-1 min-w-0">
            <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
                {{ 'EXCHANGES.TITLE' | translate }}
            </h2>
        </div>
        <!-- Status Filter -->
        <div class="mt-4 flex md:mt-0 md:ml-4 relative">
            <button type="button" (click)="toggleFilterDropdown()"
                [ngClass]="{'text-psv-green border-psv-green bg-green-50': selectedStatuses.size !== allStatuses.length, 'text-gray-700 border-gray-300 bg-white': selectedStatuses.size === allStatuses.length}"
                class="inline-flex items-center px-4 py-2 border rounded-md shadow-sm text-sm font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-psv-green">
                {{ 'EXCHANGES.FILTER_STATUS' | translate }}
                <span *ngIf="selectedStatuses.size !== allStatuses.length" class="ml-1">
                    ({{ selectedStatuses.size }}/{{ allStatuses.length }})
                </span>
                <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                    fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </button>
            <div *ngIf="isFilterDropdownOpen"
                class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10">
                <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                    <div *ngFor="let status of allStatuses"
                        class="flex items-center px-4 py-2 hover:bg-gray-100 cursor-pointer"
                        (click)="toggleStatus(status)">
                        <input type="checkbox" [checked]="selectedStatuses.has(status)"
                            class="h-4 w-4 text-psv-green focus:ring-psv-green border-gray-300 rounded">
                        <span class="ml-3 text-sm text-gray-700">{{ 'EXCHANGES.TABLE.STATUSES.' + status | translate
                            }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Info Warning -->
    <div class="rounded-md bg-blue-50 p-4 mb-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z"
                        clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3 flex-1 md:flex md:justify-between">
                <p class="text-sm text-blue-700">{{ 'EXCHANGES.CONTACT_INFO_WARNING' | translate }}</p>
            </div>
        </div>
    </div>

    <div class="space-y-8">
        <!-- Received Offers -->
        <div class="flex flex-col">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                {{ 'EXCHANGES.RECEIVED' | translate }}
            </h3>
            <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                    <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" (click)="sort('type')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.TYPE' | translate }} <span class="ml-1">{{
                                            getSortIcon('type') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('status')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.STATUS' | translate }} <span class="ml-1">{{
                                            getSortIcon('status') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('partnerId')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.PARTNER_ID' | translate }} <span class="ml-1">{{
                                            getSortIcon('partnerId') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('partner')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.PARTNER' | translate }} <span class="ml-1">{{
                                            getSortIcon('partner') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('requested')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.REQUESTED' | translate }} <span class="ml-1">{{
                                            getSortIcon('requested') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('offered')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.OFFERED' | translate }} <span class="ml-1">{{
                                            getSortIcon('offered') }}</span>
                                    </th>
                                    <th scope="col" class="relative px-6 py-3">
                                        <span class="sr-only">{{ 'EXCHANGES.TABLE.ACTIONS' | translate }}</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr *ngFor="let offer of receivedOffers">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <div class="flex items-center">
                                            <!-- Exchange Icon -->
                                            <svg *ngIf="offer.exchangeType === 'EXCHANGE'"
                                                class="mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                            <!-- Payed Icon -->
                                            <svg *ngIf="offer.exchangeType === 'PAYED'"
                                                class="mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6c.304 0 .792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95c-.285.475-.507 1.002-.67 1.55H6a1 1 0 000 2h.013a9.358 9.358 0 000 1H6a1 1 0 100 2h.351c.163.548.385 1.075.67 1.55C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 10-1.715-1.029c-.472.786-.96.979-1.264.979-.304 0-.792-.193-1.264-.979a4.265 4.265 0 01-.264-.521H10a1 1 0 100-2H8.017a7.36 7.36 0 010-1H10a1 1 0 100-2H8.472c.08-.185.167-.36.264-.521z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                            <!-- Freebie Icon -->
                                            <svg *ngIf="offer.exchangeType === 'FREEBIE'"
                                                class="mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M5 5a3 3 0 015-2.236A3 3 0 0114.83 6H16a2 2 0 110 4h-5V9a1 1 0 10-2 0v1H4a2 2 0 110-4h1.17C5.06 5.687 5 5.35 5 5zm4 1V5a1 1 0 10-1 1h1zm3 0a1 1 0 10-1-1v1h1z"
                                                    clip-rule="evenodd" />
                                                <path d="M9 11H3v5a2 2 0 002 2h4v-7zM11 18h4a2 2 0 002-2v-5h-6v7z" />
                                            </svg>
                                            {{ 'EXCHANGES.TABLE.TYPES.' + offer.exchangeType | translate }}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {{ getStatusTranslationKey(offer, 'offerer') | translate }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        {{ offer.requesterId }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {{ offer.partnerFirstname }} {{ offer.partnerLastname }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <span
                                            class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                            {{ offer.requestedStickerName }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <span *ngIf="offer.offeredStickerName"
                                            class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                            {{ offer.offeredStickerName }}
                                        </span>
                                        <span *ngIf="!offer.offeredStickerName">-</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <button (click)="openModal(offer, 'offerer')"
                                            class="text-psv-green hover:text-psv-green">
                                            {{ 'EXCHANGES.TABLE.VIEW' | translate }}
                                        </button>
                                    </td>
                                </tr>
                                <tr *ngIf="receivedOffers.length === 0 && !loading">
                                    <td colspan="7"
                                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                                        {{ 'EXCHANGES.EMPTY_RECEIVED' | translate }}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sent Requests -->
        <div class="flex flex-col">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                {{ 'EXCHANGES.SENT' | translate }}
            </h3>
            <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                    <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" (click)="sort('type')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.TYPE' | translate }} <span class="ml-1">{{
                                            getSortIcon('type') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('status')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.STATUS' | translate }} <span class="ml-1">{{
                                            getSortIcon('status') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('partnerId')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.PARTNER_ID' | translate }} <span class="ml-1">{{
                                            getSortIcon('partnerId') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('partner')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.PARTNER' | translate }} <span class="ml-1">{{
                                            getSortIcon('partner') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('requested')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.REQUESTED' | translate }} <span class="ml-1">{{
                                            getSortIcon('requested') }}</span>
                                    </th>
                                    <th scope="col" (click)="sort('offered')"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 select-none">
                                        {{ 'EXCHANGES.TABLE.OFFERED' | translate }} <span class="ml-1">{{
                                            getSortIcon('offered') }}</span>
                                    </th>
                                    <th scope="col" class="relative px-6 py-3">
                                        <span class="sr-only">{{ 'EXCHANGES.TABLE.ACTIONS' | translate }}</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr *ngFor="let request of sentRequests">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <div class="flex items-center">
                                            <!-- Exchange Icon -->
                                            <svg *ngIf="request.exchangeType === 'EXCHANGE'"
                                                class="mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                            <!-- Payed Icon -->
                                            <svg *ngIf="request.exchangeType === 'PAYED'"
                                                class="mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6c.304 0 .792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95c-.285.475-.507 1.002-.67 1.55H6a1 1 0 000 2h.013a9.358 9.358 0 000 1H6a1 1 0 100 2h.351c.163.548.385 1.075.67 1.55C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 10-1.715-1.029c-.472.786-.96.979-1.264.979-.304 0-.792-.193-1.264-.979a4.265 4.265 0 01-.264-.521H10a1 1 0 100-2H8.017a7.36 7.36 0 010-1H10a1 1 0 100-2H8.472c.08-.185.167-.36.264-.521z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                            <!-- Freebie Icon -->
                                            <svg *ngIf="request.exchangeType === 'FREEBIE'"
                                                class="mr-1.5 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M5 5a3 3 0 015-2.236A3 3 0 0114.83 6H16a2 2 0 110 4h-5V9a1 1 0 10-2 0v1H4a2 2 0 110-4h1.17C5.06 5.687 5 5.35 5 5zm4 1V5a1 1 0 10-1 1h1zm3 0a1 1 0 10-1-1v1h1z"
                                                    clip-rule="evenodd" />
                                                <path d="M9 11H3v5a2 2 0 002 2h4v-7zM11 18h4a2 2 0 002-2v-5h-6v7z" />
                                            </svg>
                                            {{ 'EXCHANGES.TABLE.TYPES.' + request.exchangeType | translate }}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {{ getStatusTranslationKey(request, 'requester') | translate }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        {{ request.offererId }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        {{ request.partnerFirstname }} {{ request.partnerLastname }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <span
                                            class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                            {{ request.requestedStickerName }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <span *ngIf="request.offeredStickerName"
                                            class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                                            {{ request.offeredStickerName }}
                                        </span>
                                        <span *ngIf="!request.offeredStickerName">-</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <button (click)="openModal(request, 'requester')"
                                            class="text-psv-green hover:text-psv-green">
                                            {{ 'EXCHANGES.TABLE.VIEW' | translate }}
                                        </button>
                                    </td>
                                </tr>
                                <tr *ngIf="sentRequests.length === 0 && !loading">
                                    <td colspan="7"
                                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                                        {{ 'EXCHANGES.EMPTY_SENT' | translate }}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Exchange Detail Modal -->
<div *ngIf="selectedExchange"
    style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 1rem;">
    <!-- Background overlay -->
    <div (click)="closeModal()"
        style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5);">
    </div>

    <!-- Modal panel -->
    <div
        style="position: relative; background: white; border-radius: 0.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); max-width: 32rem; width: 100%; max-height: 90vh; overflow-y: auto;">

        <!-- Close button -->
        <div style="position: absolute; top: 1rem; right: 1rem;">
            <button type="button" (click)="closeModal()"
                style="background: white; border-radius: 0.375rem; color: #9CA3AF; border: none; cursor: pointer;"
                onmouseover="this.style.color='#6B7280'" onmouseout="this.style.color='#9CA3AF'">
                <span class="sr-only">Close</span>
                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <div style="padding: 1.5rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #111827; margin-bottom: 1rem; text-align: center;">
                {{ 'EXCHANGE_MODAL.DETAILS_TITLE' | translate }}
            </h3>

            <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.75rem;">
                <p style="font-size: 0.875rem; color: #6B7280; display: flex; align-items: center;">
                    <strong style="color: #374151; margin-right: 0.5rem;">{{ 'EXCHANGES.TABLE.TYPE' | translate
                        }}:</strong>
                    <!-- Exchange Icon -->
                    <svg *ngIf="selectedExchange.exchangeType === 'EXCHANGE'"
                        style="height: 1.25rem; width: 1.25rem; color: #9CA3AF; margin-right: 0.375rem;"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                            clip-rule="evenodd" />
                    </svg>
                    <!-- Payed Icon -->
                    <svg *ngIf="selectedExchange.exchangeType === 'PAYED'"
                        style="height: 1.25rem; width: 1.25rem; color: #9CA3AF; margin-right: 0.375rem;"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6c.304 0 .792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95c-.285.475-.507 1.002-.67 1.55H6a1 1 0 000 2h.013a9.358 9.358 0 000 1H6a1 1 0 100 2h.351c.163.548.385 1.075.67 1.55C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 10-1.715-1.029c-.472.786-.96.979-1.264.979-.304 0-.792-.193-1.264-.979a4.265 4.265 0 01-.264-.521H10a1 1 0 100-2H8.017a7.36 7.36 0 010-1H10a1 1 0 100-2H8.472c.08-.185.167-.36.264-.521z"
                            clip-rule="evenodd" />
                    </svg>
                    <!-- Freebie Icon -->
                    <svg *ngIf="selectedExchange.exchangeType === 'FREEBIE'"
                        style="height: 1.25rem; width: 1.25rem; color: #9CA3AF; margin-right: 0.375rem;"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M5 5a3 3 0 015-2.236A3 3 0 0114.83 6H16a2 2 0 110 4h-5V9a1 1 0 10-2 0v1H4a2 2 0 110-4h1.17C5.06 5.687 5 5.35 5 5zm4 1V5a1 1 0 10-1 1h1zm3 0a1 1 0 10-1-1v1h1z"
                            clip-rule="evenodd" />
                        <path d="M9 11H3v5a2 2 0 002 2h4v-7zM11 18h4a2 2 0 002-2v-5h-6v7z" />
                    </svg>
                    {{ 'EXCHANGES.TABLE.TYPES.' + selectedExchange.exchangeType | translate }}
                </p>
                <p style="font-size: 0.875rem; color: #6B7280;">
                    <strong style="color: #374151;">{{ 'EXCHANGES.TABLE.STATUS' | translate }}:</strong> {{
                    getStatusTranslationKey(selectedExchange, userRole) | translate }}
                </p>

                <!-- Closed Status for Interest -->
                <div *ngIf="selectedExchange.status === 'EXCHANGE_INTERREST'"
                    style="margin-left: 1rem; font-size: 0.875rem; color: #6B7280;">
                    <p *ngIf="selectedExchange.requesterClosed">
                        <span style="color: #059669;">✓</span> {{ (userRole === 'requester' ?
                        'EXCHANGES.TABLE.STATUSES.STATUS_RECEIVED' : 'EXCHANGES.TABLE.STATUSES.STATUS_GIVEN') |
                        translate }}
                    </p>
                    <p *ngIf="selectedExchange.offererClosed">
                        <span style="color: #059669;">✓</span> {{ (userRole === 'requester' ?
                        'EXCHANGES.TABLE.STATUSES.STATUS_RECEIVED' : 'EXCHANGES.TABLE.STATUSES.STATUS_GIVEN') |
                        translate }}
                    </p>
                </div>

                <p style="font-size: 0.875rem; color: #6B7280;">
                    <strong style="color: #374151;">{{ 'EXCHANGES.TABLE.PARTNER_ID' | translate }}:</strong> {{
                    selectedExchange.requesterId || selectedExchange.offererId }}
                </p>
                <p style="font-size: 0.875rem; color: #6B7280;">
                    <strong style="color: #374151;">{{ 'EXCHANGES.TABLE.PARTNER' | translate }}:</strong> {{
                    selectedExchange.partnerFirstname }} {{ selectedExchange.partnerLastname }}
                </p>
                <p style="font-size: 0.875rem; color: #6B7280;" *ngIf="selectedExchange.partnerContact">
                    <strong style="color: #374151;">{{ 'EXCHANGE_MODAL.PARTNER_CONTACT' | translate }}:</strong> {{
                    selectedExchange.partnerContact }}
                </p>
                <p style="font-size: 0.875rem; color: #6B7280;">
                    <strong style="color: #374151;">{{ 'EXCHANGES.TABLE.REQUESTED' | translate }}:</strong>
                    <span
                        class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                        {{ selectedExchange.requestedStickerName }}
                    </span>
                </p>
                <p style="font-size: 0.875rem; color: #6B7280;">
                    <strong style="color: #374151;">{{ 'EXCHANGES.TABLE.OFFERED' | translate }}:</strong>
                    <span *ngIf="selectedExchange.offeredStickerName"
                        class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                        {{ selectedExchange.offeredStickerName }}
                    </span>
                    <span *ngIf="!selectedExchange.offeredStickerName">-</span>
                </p>
            </div>
        </div>

        <!-- Modal footer -->
        <div
            style="background-color: #F9FAFB; padding: 0.75rem 1.5rem; display: flex; flex-direction: row-reverse; gap: 0.75rem;">
            <!-- Accept -->
            <button
                *ngIf="(selectedExchange.status === 'INITIAL' || selectedExchange.status === 'MAIL_SEND') && userRole === 'offerer'"
                type="button" (click)="acceptExchange()"
                style="width: 100%; display: inline-flex; justify-content: center; border-radius: 0.375rem; border: none; padding: 0.5rem 1rem; background-color: oklch(58.7% 0.181 145.4); color: white; font-size: 0.875rem; font-weight: 500; cursor: pointer;"
                onmouseover="this.style.backgroundColor='oklch(55% 0.181 145.4)'"
                onmouseout="this.style.backgroundColor='oklch(58.7% 0.181 145.4)'">
                {{ 'EXCHANGE_MODAL.ACTIONS.ACCEPT' | translate }}
            </button>

            <!-- Close -->
            <button type="button" (click)="initiateCloseExchange()" [disabled]="!(selectedExchange.status === 'EXCHANGE_INTERREST' && 
                             ((userRole === 'requester' && !selectedExchange.requesterClosed) || 
                              (userRole === 'offerer' && !selectedExchange.offererClosed)))"
                style="width: 100%; display: inline-flex; justify-content: center; border-radius: 0.375rem; border: none; padding: 0.5rem 1rem; background-color: oklch(58.7% 0.181 145.4); color: white; font-size: 0.875rem; font-weight: 500; cursor: pointer;"
                [style.opacity]="!(selectedExchange.status === 'EXCHANGE_INTERREST' && ((userRole === 'requester' && !selectedExchange.requesterClosed) || (userRole === 'offerer' && !selectedExchange.offererClosed))) ? '0.5' : '1'"
                [style.cursor]="!(selectedExchange.status === 'EXCHANGE_INTERREST' && ((userRole === 'requester' && !selectedExchange.requesterClosed) || (userRole === 'offerer' && !selectedExchange.offererClosed))) ? 'not-allowed' : 'pointer'"
                onmouseover="if(!(selectedExchange.status === 'EXCHANGE_INTERREST' && ((userRole === 'requester' && !selectedExchange.requesterClosed) || (userRole === 'offerer' && !selectedExchange.offererClosed)))) return; this.style.backgroundColor='oklch(55% 0.181 145.4)'"
                onmouseout="if(!(selectedExchange.status === 'EXCHANGE_INTERREST' && ((userRole === 'requester' && !selectedExchange.requesterClosed) || (userRole === 'offerer' && !selectedExchange.offererClosed)))) return; this.style.backgroundColor='oklch(58.7% 0.181 145.4)'">
                {{ 'EXCHANGE_MODAL.ACTIONS.CLOSE' | translate }}
            </button>

            <!-- Decline -->
            <button
                *ngIf="selectedExchange.status !== 'EXCHANGE_COMPLETED' && selectedExchange.status !== 'EXCHANGE_CANCELED'"
                type="button" (click)="declineExchange()" [disabled]="isDeclineDisabled()"
                style="width: 100%; display: inline-flex; justify-content: center; border-radius: 0.375rem; border: 1px solid #D1D5DB; padding: 0.5rem 1rem; background-color: white; color: #374151; font-size: 0.875rem; font-weight: 500; cursor: pointer;"
                [style.opacity]="isDeclineDisabled() ? '0.5' : '1'"
                [style.cursor]="isDeclineDisabled() ? 'not-allowed' : 'pointer'"
                onmouseover="if(isDeclineDisabled()) return; this.style.backgroundColor='#F9FAFB'"
                onmouseout="if(isDeclineDisabled()) return; this.style.backgroundColor='white'">
                {{ 'EXCHANGE_MODAL.ACTIONS.DECLINE' | translate }}
            </button>
        </div>
    </div>
</div>

<!-- Close Warning Modal -->
<div *ngIf="showCloseWarning"
    style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1010; display: flex; align-items: center; justify-content: center; padding: 1rem;">
    <!-- Background overlay -->
    <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5);">
    </div>

    <!-- Modal panel -->
    <div
        style="position: relative; background: white; border-radius: 0.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); max-width: 28rem; width: 100%;">
        <div style="padding: 1.5rem;">
            <div style="display: flex; align-items: flex-start;">
                <div
                    style="margin-right: 1rem; flex-shrink: 0; display: flex; align-items: center; justify-content: center; height: 3rem; width: 3rem; border-radius: 9999px; background-color: #FEE2E2;">
                    <svg style="height: 1.5rem; width: 1.5rem; color: #DC2626;" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <div style="margin-top: 0.75rem; text-align: left;">
                    <h3 style="font-size: 1.125rem; font-weight: 600; color: #111827; line-height: 1.5;"
                        id="modal-title">
                        {{ 'EXCHANGE_MODAL.CLOSE_WARNING_TITLE' | translate }}
                    </h3>
                    <div style="margin-top: 0.5rem;">
                        <p style="font-size: 0.875rem; color: #6B7280;">
                            {{ 'EXCHANGE_MODAL.CLOSE_WARNING_DESC' | translate }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal footer -->
        <div
            style="background-color: #F9FAFB; padding: 0.75rem 1.5rem; display: flex; flex-direction: row-reverse; gap: 0.75rem;">
            <button type="button" (click)="confirmCloseExchange()"
                style="width: 100%; display: inline-flex; justify-content: center; border-radius: 0.375rem; border: none; padding: 0.5rem 1rem; background-color: #DC2626; color: white; font-size: 0.875rem; font-weight: 500; cursor: pointer;"
                onmouseover="this.style.backgroundColor='#B91C1C'" onmouseout="this.style.backgroundColor='#DC2626'">
                {{ 'EXCHANGE_MODAL.ACTIONS.CONFIRM_CLOSE' | translate }}
            </button>
            <button type="button" (click)="cancelCloseWarning()"
                style="width: 100%; display: inline-flex; justify-content: center; border-radius: 0.375rem; border: 1px solid #D1D5DB; padding: 0.5rem 1rem; background-color: white; color: #374151; font-size: 0.875rem; font-weight: 500; cursor: pointer;"
                onmouseover="this.style.backgroundColor='#F9FAFB'" onmouseout="this.style.backgroundColor='white'">
                {{ 'COMMON.CANCEL' | translate }}
            </button>
        </div>
    </div>
</div>