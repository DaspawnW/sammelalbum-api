<div *ngIf="isOpen"
    style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 3000; display: flex; align-items: center; justify-content: center; padding: 1rem;">
    <!-- Background overlay -->
    <div (click)="onCancel()"
        style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5);">
    </div>

    <!-- Modal panel -->
    <div
        style="position: relative; background: white; border-radius: 0.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); max-width: 32rem; width: 100%; max-height: 90vh; overflow-y: auto;">

        <div style="padding: 1.5rem; padding-bottom: 0; text-align: left;">
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #111827; margin-bottom: 1rem; margin-top: 0;">
                {{ 'PASSWORD.TITLE' | translate }}
            </h3>

            <!-- Success Message -->
            <div *ngIf="successMessage"
                style="margin-bottom: 1rem; padding: 0.75rem; background-color: #f0fdf4; border-radius: 4px; border: 1px solid #16a34a; color: #16a34a; font-size: 0.875rem;">
                {{ successMessage | translate }}
            </div>

            <!-- Error Message -->
            <div *ngIf="errorMessage"
                style="margin-bottom: 1rem; padding: 0.75rem; background-color: #fef2f2; border-radius: 4px; border: 1px solid #dc2626; color: #dc2626; font-size: 0.875rem;">
                {{ errorMessage | translate }}
            </div>

            <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
                <!-- Current Password -->
                <div style="margin-bottom: 1rem;">
                    <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-1">{{
                        'PASSWORD.CURRENT_PASSWORD' | translate }}</label>
                    <input type="password" id="currentPassword" formControlName="currentPassword"
                        class="appearance-none rounded-lg relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-psv-green focus:border-psv-green focus:z-10 sm:text-sm transition-colors duration-200">
                    <div *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
                        style="color: #dc2626; font-size: 0.875rem; margin-top: 0.25rem;">
                        {{ 'VALIDATION.REQUIRED' | translate }}
                    </div>
                </div>

                <!-- New Password -->
                <div style="margin-bottom: 1rem;">
                    <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">{{
                        'PASSWORD.NEW_PASSWORD' | translate }}</label>
                    <input type="password" id="newPassword" formControlName="newPassword"
                        class="appearance-none rounded-lg relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-psv-green focus:border-psv-green focus:z-10 sm:text-sm transition-colors duration-200">
                    <div *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
                        style="color: #dc2626; font-size: 0.875rem; margin-top: 0.25rem;">
                        <span *ngIf="passwordForm.get('newPassword')?.errors?.['required']">{{ 'VALIDATION.REQUIRED' |
                            translate }}</span>
                        <span *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">{{ 'PASSWORD.MIN_LENGTH' |
                            translate }}</span>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div style="margin-bottom: 1rem;">
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">{{
                        'PASSWORD.CONFIRM_PASSWORD' | translate }}</label>
                    <input type="password" id="confirmPassword" formControlName="confirmPassword"
                        class="appearance-none rounded-lg relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-psv-green focus:border-psv-green focus:z-10 sm:text-sm transition-colors duration-200">
                    <div *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched"
                        style="color: #dc2626; font-size: 0.875rem; margin-top: 0.25rem;">
                        {{ 'PASSWORD.MISMATCH' | translate }}
                    </div>
                </div>
            </form>
        </div>

        <!-- Modal footer -->
        <div
            style="background-color: #F9FAFB; padding: 0.75rem 1.5rem; display: flex; flex-direction: row-reverse; gap: 0.75rem;">
            <button type="button" (click)="onSubmit()" [disabled]="passwordForm.invalid || isSubmitting"
                style="width: 100%; display: inline-flex; justify-content: center; border-radius: 0.375rem; border: none; padding: 0.5rem 1rem; background-color: oklch(58.7% 0.181 145.4); color: white; font-size: 0.875rem; font-weight: 500; cursor: pointer;"
                [style.opacity]="(passwordForm.invalid || isSubmitting) ? '0.5' : '1'"
                [style.cursor]="(passwordForm.invalid || isSubmitting) ? 'not-allowed' : 'pointer'"
                onmouseover="if(this.disabled) return; this.style.backgroundColor='oklch(55% 0.181 145.4)'"
                onmouseout="if(this.disabled) return; this.style.backgroundColor='oklch(58.7% 0.181 145.4)'">
                {{ isSubmitting ? ('COMMON.SAVING' | translate) : ('PASSWORD.SAVE' | translate) }}
            </button>
            <button type="button" (click)="onCancel()"
                style="width: 100%; display: inline-flex; justify-content: center; border-radius: 0.375rem; border: 1px solid #D1D5DB; padding: 0.5rem 1rem; background-color: white; color: #374151; font-size: 0.875rem; font-weight: 500; cursor: pointer;"
                onmouseover="this.style.backgroundColor='#F9FAFB'" onmouseout="this.style.backgroundColor='white'">
                {{ 'PASSWORD.CANCEL' | translate }}
            </button>
        </div>
    </div>
</div>